## Customize the test machine
machine:
  node:
    version: v0.12.2
  services:
    - docker
  environment:
    PATH: ${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin

## Cache base docker image (nginx) and node_modules to speed up rebuilding
dependencies:
  cache_directories:
    - "~/docker"

  override:
    - mkdir -p ~/docker
    - if [[ -e ~/docker/base.tar ]]; then docker load -i ~/docker/base.tar; else docker pull nginx && docker save nginx > ~/docker/base.tar; fi

## Customize test commands
test:
  pre:
    - gulp build.test
    - docker build -t avipost.web dist/
    - docker run --name=app -p 8000:80 -d avipost.web 
    - wget -O selenium-server.jar http://selenium-release.storage.googleapis.com/2.45/selenium-server-standalone-2.45.0.jar
    - java -jar selenium-server.jar:
        background: true
  override:
    - nightwatch -c e2e/nightwatch.json
